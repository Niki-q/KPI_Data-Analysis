# Імпортування скрипту завантаження та очистки даних
```{r}
source("cleaning.R")
library(qqplotr)
library(GGally)
```
# Завантаження попередньо очищених даних
```{r}
data <- clean_date()
```
# Перегляд основної інформації про датасет
```{r}
str(data)
```
# Перегляд підсумкових характеристик числових змінних
```{r}
summary(data)
```
## Побудуємо box plots для деяких числових змінних:
(зробити універсальну функцію)
popularity:
```{r}
ggplot(data, aes(y = popularity)) +
    geom_boxplot() +
    labs(y = "Популярність треків") +
    theme(axis.title = element_text(size = 25),
        axis.text = element_text(size = 20))
```
valence:
```{R}
ggplot(data, aes(y = valence)) +
    geom_boxplot() +
    labs(y = "Валентність треків") +
     theme(axis.title = element_text(size = 40),
        axis.text = element_text(size = 40))
```
duration_ms: (треба переробити!)
```{R}
ggplot(data, aes(y = duration_ms)) +
    geom_boxplot() +
    labs(y = "Тривалість треків") +
     theme(axis.title = element_text(size = 40),
        axis.text = element_text(size = 40))
```
energy:
```{R}
ggplot(data, aes(y = energy)) +
    geom_boxplot() +
    labs(y = "Енергійність треків") +
     theme(axis.title = element_text(size = 40),
        axis.text = element_text(size = 40))
```
tempo:
```{r}
ggplot(data, aes(y = tempo)) +
    geom_boxplot() +
    labs(y = "Темп треків") +
     theme(axis.title = element_text(size = 40),
        axis.text = element_text(size = 40))
```
speechiness:
```{r}
ggplot(data, aes(y = speechiness)) +
    geom_boxplot() +
    labs(y = "Мовність треку (speechiness)") +
     theme(axis.title = element_text(size = 40),
        axis.text = element_text(size = 40))
```
# Виявлення викидів в числових змінних
Застосуємо фільтр Гампеля для числових змінних
```{r}
data %>% filter(popularity < median(popularity) - 3 * mad(popularity) |
    popularity > median(popularity) + 3 * mad(popularity)) %>%
    arrange(desc(popularity))

data %>% filter(duration_ms < median(duration_ms) - 3 * mad(duration_ms) |
    duration_ms > median(duration_ms) + 3 * mad(duration_ms)) %>%
    arrange(desc(duration_ms))

data %>% filter(danceability < median(danceability) - 3 * mad(danceability) |
    danceability > median(danceability) + 3 * mad(danceability)) %>%
    arrange(desc(danceability))

data %>% filter(energy < median(energy) - 3 * mad(energy) |
    energy > median(energy) + 3 * mad(energy)) %>%
    arrange(desc(energy))

data %>% filter(loudness < median(loudness) - 3 * mad(loudness) |
    loudness > median(loudness) + 3 * mad(loudness)) %>%
    arrange(desc(loudness))

data %>% filter(speechiness < median(speechiness) - 3 * mad(speechiness) |
    speechiness > median(speechiness) + 3 * mad(speechiness)) %>%
    arrange(desc(speechiness))

data %>% filter(acousticness < median(acousticness) - 3 * mad(acousticness) |
    acousticness > median(acousticness) + 3 * mad(acousticness)) %>%
    arrange(desc(acousticness))

data %>% filter(instrumentalness < median(instrumentalness) - 3 * mad(instrumentalness) |
    instrumentalness > median(instrumentalness) + 3 * mad(instrumentalness)) %>%
    arrange(desc(instrumentalness))

data %>% filter(liveness < median(liveness) - 3 * mad(liveness) |
    liveness > median(liveness) + 3 * mad(liveness)) %>%
    arrange(desc(liveness))

data %>% filter(valence < median(valence) - 3 * mad(valence) |
    valence > median(valence) + 3 * mad(valence)) %>%
    arrange(desc(valence))

data %>% filter(tempo < median(tempo) - 3 * mad(tempo) |
    tempo > median(tempo) + 3 * mad(tempo)) %>%
    arrange(desc(tempo))

data %>% filter(time_signature < median(time_signature) - 3 * mad(time_signature) |
    time_signature > median(time_signature) + 3 * mad(time_signature)) %>%
    arrange(desc(time_signature))
```
# Побудова QQ-графіків для візуальної перевірки розподілу та наявності викидів
```{r}
ggplot(data, aes(sample = popularity)) +
    stat_qq_point() + stat_qq_line() + stat_qq_band() +
    labs(x = "Квантилі нормального розподілу", y = "Популярність") +
    theme(axis.title = element_text(size = 25),
    axis.text = element_text(size = 20))
```
```{R}
ggplot(data, aes(sample = valence)) +
    stat_qq_point() + stat_qq_line() + stat_qq_band() +
    labs(x = "Квантилі нормального розподілу", y = "Valence") +
    theme(axis.title = element_text(size = 25),
    axis.text = element_text(size = 20))
```
```{R}
ggplot(data, aes(sample = duration_ms)) +
    stat_qq_point() + stat_qq_line() + stat_qq_band() +
    labs(x = "Квантилі нормального розподілу", y = "Duration, ms") +
    theme(axis.title = element_text(size = 25),
    axis.text = element_text(size = 20))
```
```{R}
ggplot(data, aes(sample = energy)) +
    stat_qq_point() + stat_qq_line() + stat_qq_band() +
    labs(x = "Квантилі нормального розподілу", y = "Energy") +
    theme(axis.title = element_text(size = 25),
    axis.text = element_text(size = 20))
```
```{R}
ggplot(data, aes(sample = tempo)) +
    stat_qq_point() + stat_qq_line() + stat_qq_band() +
    labs(x = "Квантилі нормального розподілу", y = "Tempo") +
    theme(axis.title = element_text(size = 25),
    axis.text = element_text(size = 20))
```
```{R}
ggplot(data, aes(sample = speechiness)) +
    stat_qq_point() + stat_qq_line() + stat_qq_band() +
    labs(x = "Квантилі нормального розподілу", y = "Speechiness") +
    theme(axis.title = element_text(size = 25),
    axis.text = element_text(size = 20))
```
# Побудова гістограм для деяких неперервних змінних
```{r}
data %>%
    ggplot(aes(x = popularity)) +
    geom_histogram(color = "#e9ecef", alpha = 0.6, position = 'identity') +
    labs(fill = "")
```
```{r}
data %>%
    ggplot(aes(x = valence)) +
    geom_histogram(color = "#e9ecef", alpha = 0.6, position = 'identity') +
    labs(fill = "")
```
```{r}
data %>%
    ggplot(aes(x = duration_ms)) +
    geom_histogram(color = "#e9ecef", alpha = 0.6, position = 'identity') +
    labs(fill = "")
```
```{r}
data %>%
    ggplot(aes(x = energy)) +
    geom_histogram(color = "#e9ecef", alpha = 0.6, position = 'identity') +
    labs(fill = "")
```
```{r}
data %>%
    ggplot(aes(x = tempo)) +
    geom_histogram(color = "#e9ecef", alpha = 0.6, position = 'identity') +
    labs(fill = "")
```
```{r}
data %>%
    ggplot(aes(x = speechiness)) +
    geom_histogram(color = "#e9ecef", alpha = 0.6, position = 'identity') +
    labs(fill = "")
```
# Побудова гістограм та QQ-графіків прологаритмованих змінних
```{r}
data %>%
    ggplot(aes(x = log(popularity))) +
    geom_histogram(color = "#e9ecef", alpha = 0.6, position = 'identity') +
    labs(fill = "")
```
```{r}
ggplot(data, aes(sample = log(popularity))) +
    stat_qq_point() + stat_qq_line() + stat_qq_band() +
    labs(x = "Квантилі нормального розподілу", y = "Популярність") +
    theme(axis.title = element_text(size = 25),
    axis.text = element_text(size = 20))
```
```{R}
ggplot(data, aes(sample = log(valence))) +
    stat_qq_point() + stat_qq_line() + stat_qq_band() +
    labs(x = "Квантилі нормального розподілу", y = "Valence") +
    theme(axis.title = element_text(size = 25),
    axis.text = element_text(size = 20))
```
```{r}
data %>%
    ggplot(aes(x = log(valence))) +
    geom_histogram(color = "#e9ecef", alpha = 0.6, position = 'identity') +
    labs(fill = "")
```
```{R}
ggplot(data, aes(sample = log(duration_ms))) +
    stat_qq_point() + stat_qq_line() + stat_qq_band() +
    labs(x = "Квантилі нормального розподілу", y = "Duration, ms") +
    theme(axis.title = element_text(size = 25),
    axis.text = element_text(size = 20))
```
```{r}
data %>%
    ggplot(aes(x = log(duration_ms))) +
    geom_histogram(color = "#e9ecef", alpha = 0.6, position = 'identity') +
    labs(fill = "")
```
```{R}
ggplot(data, aes(sample = log(energy))) +
    stat_qq_point() + stat_qq_line() + stat_qq_band() +
    labs(x = "Квантилі нормального розподілу", y = "Energy") +
    theme(axis.title = element_text(size = 25),
    axis.text = element_text(size = 20))
```
```{r}
data %>%
    ggplot(aes(x = log(energy))) +
    geom_histogram(color = "#e9ecef", alpha = 0.6, position = 'identity') +
    labs(fill = "")
```
```{R}
ggplot(data, aes(sample = log(tempo))) +
    stat_qq_point() + stat_qq_line() + stat_qq_band() +
    labs(x = "Квантилі нормального розподілу", y = "Tempo") +
    theme(axis.title = element_text(size = 25),
    axis.text = element_text(size = 20))
```
```{r}
data %>%
    ggplot(aes(x = log(tempo))) +
    geom_histogram(color = "#e9ecef", alpha = 0.6, position = 'identity') +
    labs(fill = "")
```
```{R}
ggplot(data, aes(sample = log(speechiness))) +
    stat_qq_point() + stat_qq_line() + stat_qq_band() +
    labs(x = "Квантилі нормального розподілу", y = "Speechiness") +
    theme(axis.title = element_text(size = 25),
    axis.text = element_text(size = 20))
```
```{r}
data %>%
    ggplot(aes(x = log(speechiness))) +
    geom_histogram(color = "#e9ecef", alpha = 0.6, position = 'identity') +
    labs(fill = "")
```
# 5 найпопулярніших артистів
```{r}
most_popular_artists <-
    data %>%
    group_by(artists) %>%
    summarise(popularity = sum(popularity)) %>%
    arrange(desc(popularity)) %>%
    head(5)
```
# 5 найпопулярніших альбомів
```{r}
most_popular_albums <-
    data %>%
    group_by(album_name) %>%
    summarise(popularity = sum(popularity)) %>%
    arrange(desc(popularity)) %>%
    head(5)
most_popular_albums
```
# Спільні харакетристики найпопулярніших альбомів 

# 5 найпопулярніших жанрів
```{r}
most_popular_genres <-
    data %>%
    group_by(track_genre) %>%
    summarise(popularity = sum(popularity)) %>%
    arrange(desc(popularity)) %>%
    head(5)

most_popular_genres
```
# Графік кореляції числових змінних
```{r}
ggcorr(data %>% select(where(is.numeric)), label = TRUE)
```
# Залежність популярності від валентності (valence)
```{r}
ggcorr(data %>% select(popularity, valence), label = TRUE)
```
```{r}
data %>%
    tail(15) %>%
    ggplot(aes(x = popularity, y = valence)) +
        geom_line() +
        geom_point()
```
# Вплив тривалості треку на його Енергійність
```{r}
ggcorr(data %>% select(duration_ms, energy), label = TRUE)
```
# Вплив темпу на мовність (speechiness)
```{r}
ggcorr(data %>% select(tempo, speechiness), label = TRUE)
```
# Вплив ненормативної лексики на мовність (speechiness)
```{r}
data %>%
    ggplot(aes(x = explicit, y = speechiness)) +
    geom_bar(stat = "identity")
```
